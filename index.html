<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Impulse Evolution üöÄ</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      background: #082145;
      color: #f0f6ff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 18px;
    }
    h1 {
      font-size: 30px;
      margin-bottom: 4px;
    }
    .stats {
      font-size: 18px;
      margin: 10px 0;
    }
    button {
      margin: 8px 6px;
      padding: 15px 30px;
      font-size: 20px;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: transform 0.13s, box-shadow 0.13s;
    }
    button:active { transform: scale(0.95); }
    .btn-main {
      background: #20a74a;
      color: #fff;
      box-shadow: 0px 6px 0px #128234;
    }
    .btn-blue {
      background: #3377ff;
      color: #fff;
      box-shadow: 0px 6px 0px #1f4bb4;
    }
    .btn-disabled {
      background: #4c5266;
      color: #a1a1ab;
      cursor: not-allowed;
    }
    #menuArea { margin-top: 22px; font-size: 18px; }
    #notif {
      font-size: 20px;
      margin-top: 12px;
      padding: 8px;
      border-radius: 8px;
      animation: fadeInOut 2.6s ease-in-out;
    }
    @keyframes fadeInOut {
      0% {opacity: 0;}
      15% {opacity: 1;}
      70% {opacity: 1;}
      100% {opacity: 0;}
    }
    .section {
      margin-top: 18px;
      padding: 14px;
      background: #12325e;
      border-radius: 12px;
    }
    .mission-ok { color: #22e55e; }
    .mission-no { color: #f87171; }
    #rankList li {
      text-align: left;
      font-size: 19px;
      margin: 3px 0;
    }
    .progress-container {
      width: 85%;
      height: 18px;
      background: #0f2040;
      border-radius: 12px;
      margin: 8px auto;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }
    .progress-inner {
      height: 100%;
      background: linear-gradient(90deg, #20a74a, #3377ff);
      width: 0%;
      transition: width 0.7s ease;
    }
  </style>
</head>
<body>

<h1>Impulse Evolution üöÄ</h1>

<div class="stats">
  ü™ô <span id="coinsDisplay">0</span> |
  ‚ö° <span id="energyDisplay">0</span>/100 |
  ‚≠ê <span id="levelDisplay">1</span> |
  üî• <span id="xpDisplay">0</span>
</div>

<div class="progress-container">
  <div id="xpBar" class="progress-inner"></div>
</div>

<button class="btn-main" onclick="btnClick()">TOCAR!</button>
<button class="btn-blue" onclick="menu('upgrades')">Upgrades</button>
<button class="btn-blue" onclick="menu('missions')">Miss√µes</button>
<button class="btn-blue" onclick="menu('ranking')">Ranking Global</button>

<div id="notif"></div>
<div id="menuArea"></div>

<audio id="soundClick"></audio>
<audio id="soundLevel"></audio>
<audio id="soundMission"></audio>
<audio id="soundRank"></audio>

<script>
// ==================
// üîä Sons Base64 (s√∫til)
// ==================
document.getElementById("soundClick").src =
"data:audio/mp3;base64,//uQxAAAAAAD...";
document.getElementById("soundLevel").src =
"data:audio/mp3;base64,//uQxAAA...";
document.getElementById("soundMission").src =
"data:audio/mp3;base64,//uQxAAA...";
document.getElementById("soundRank").src =
"data:audio/mp3;base64,//uQxAAA...";

// ==================
// üßæ Jogador
// ==================
const player = {
  coins: 0, energy: 100,
  level: 1, xp: 0,
  upgrades: {power:1, speed:0},
  missions: {clicks:0, donePlay100:false, doneLevel5:false}
};

// ==================
// üíæ LocalStorage
// ==================
function saveAll(){ localStorage.setItem("impulse_full_b", JSON.stringify(player)); }
function loadAll(){
  const d = localStorage.getItem("impulse_full_b");
  if(d) Object.assign(player, JSON.parse(d));
}

// ==================
// üéÆ Click
// ==================
function btnClick(){
  document.getElementById("soundClick").play();
  if(player.energy <= 0){ notify("‚ö° Sem energia!"); return; }
  player.coins += player.upgrades.power;
  player.energy--;
  player.xp++;
  player.missions.clicks++;
  updateBar();
  checkLvl(); checkMissions();
  saveAll(); updateDisplay();
}

// ==================
// üîº Level Up
// ==================
function checkLvl(){
  if(player.xp >= player.level * 60){
    player.level++;
    player.energy = Math.min(player.energy + 20, 100);
    player.xp = 0;
    document.getElementById("soundLevel").play();
    notify("‚≠ê Subiu de N√≠vel!");
    updateBar();
  }
}

// ==================
// üéâ Miss√µes
// ==================
function checkMissions(){
  if(player.missions.clicks>=100 && !player.missions.donePlay100){
    player.missions.donePlay100 = true;
    player.coins += 50;
    document.getElementById("soundMission").play();
    notify("üéØ Miss√£o 100 cliques!");
  }
  if(player.level>=5 && !player.missions.doneLevel5){
    player.missions.doneLevel5 = true;
    player.coins += 100;
    document.getElementById("soundMission").play();
    notify("üåü Miss√£o N√≠vel 5!");
  }
}

// ==================
// üìä UI Updates
// ==================
function updateDisplay(){
  document.getElementById("coinsDisplay").innerText = player.coins;
  document.getElementById("energyDisplay").innerText = player.energy;
  document.getElementById("levelDisplay").innerText = player.level;
  document.getElementById("xpDisplay").innerText = player.xp;
  updateBar();
}
function updateBar(){
  const pct = Math.min((player.xp / (player.level * 60)) * 100, 100);
  document.getElementById("xpBar").style.width = pct + "%";
}

// ==================
// üì£ Notifica√ß√£o
// ==================
function notify(txt){
  const n = document.getElementById("notif");
  n.innerText = txt;
}

// ==================
// üü¢ Menus
// ==================
function menu(type){
  let html = "";
  if(type=="upgrades"){
    html += `<div class="section"><h3>Upgrades</h3>`;
    html += btnList("Power +1 (50)", player.coins>=50, ()=>buy("power",50));
    html += btnList("Speed +20 energia (30)", player.coins>=30, ()=>buy("speed",30));
    html += `</div>`;
  }
  if(type=="missions"){
    html += `<div class="section"><h3>Miss√µes</h3>`;
    html += `<p class="${player.missions.donePlay100?'mission-ok':'mission-no'}">‚Ä¢ Clique 100√ó</p>`;
    html += `<p class="${player.missions.doneLevel5?'mission-ok':'mission-no'}">‚Ä¢ Chegar n√≠vel 5</p>`;
    html += `</div>`;
  }
  if(type=="ranking"){
    html += `<div class="section"><h3>Ranking Global</h3><div id="rankList">Carregando...</div></div>`;
    fetchRank();
  }
  document.getElementById("menuArea").innerHTML = html;
}
function btnList(txt, ok, act){
  return `<button class="${ok?'btn-main':'btn-disabled'}" ${ok? `onclick="${act.name}()"`:""}>${txt}</button><br>`;
}
function buy(type,c){if(player.coins<c){notify("ü™ô Sem moedas");return;}player.coins-=c;player.upgrades[type]++;saveAll();updateDisplay();menu("upgrades");notify("‚úîÔ∏è Comprado");}

// ==================
// üåç Ranking
// ==================
async function fetchRank(){
  document.getElementById("soundRank").play();
  const q = encodeURIComponent("select A, C order by C desc limit 10");
  const url = `${gURL}tq=${q}`;
  try{
    const r = await fetch(url); const t = await r.text();
    const js = t.substring(t.indexOf("{"), t.lastIndexOf("}")+1);
    const arr = JSON.parse(js).table.rows;
    let out="<ol>";
    arr.forEach(r=> { const nm=r.c[0]?r.c[0].v:"‚Äî"; const lv=r.c[1]?r.c[1].v:0; out+=`<li>${nm} ‚≠ê ${lv}</li>`; });
    out+="</ol>";
    document.getElementById("rankList").innerHTML = out;
  } catch{document.getElementById("rankList").innerHTML="‚ö†Ô∏è Falha ao carregar";}
}

// ==================
// üîÅ Energia Regen
// ==================
setInterval(()=>{if(player.energy<100){player.energy++;saveAll();updateDisplay();}},5000);

// ==================
// üöÄ In√≠cio
// ==================
loadAll(); Telegram.WebApp.expand(); updateDisplay();

</script>
</body>
</html>

