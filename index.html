<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Impulse Evolution üöÄ</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  body {
    background: #0a1a33;
    color: #e2e8f0;
    font-family: Arial, sans-serif;
    text-align: center;
    padding-top: 20px;
  }
  h1 {
    font-size: 28px;
    margin-bottom: 6px;
  }
  .stats {
    font-size: 18px;
    margin: 12px 0;
  }
  button {
    margin: 8px 6px;
    padding: 14px 30px;
    font-size: 19px;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    transition: transform 0.12s, box-shadow 0.12s;
  }
  button:active {
    transform: scale(0.97);
  }
  .btn-main {
    background: #16a34a;
    color: #fff;
    box-shadow: 0px 6px 0px #0f6d32;
  }
  .btn-blue {
    background: #2563eb;
    color: #fff;
    box-shadow: 0px 6px 0px #1b3db4;
  }
  .btn-disabled {
    background: #4b5563;
    color: #a1a1aa;
    cursor: not-allowed;
  }
  #menuArea {
    margin-top: 22px;
    font-size: 18px;
  }
  #notif {
    font-size: 20px;
    margin-top: 10px;
    color: #fde047;
  }
  .section {
    margin-top: 18px;
    padding: 12px;
    background: #12243f;
    border-radius: 12px;
  }
  .mission-ok {
    color: #22c55e;
  }
  .mission-no {
    color: #ef4444;
  }
  #rankList li {
    text-align: left;
    font-size: 18px;
    margin: 2px 0;
  }
</style>
</head>
<body>

<h1>Impulse Evolution üöÄ</h1>

<div class="stats">
  Moedas ü™ô: <span id="coinsDisplay">0</span><br>
  Energia ‚ö°: <span id="energyDisplay">0</span>/100 |
  N√≠vel ‚≠ê: <span id="levelDisplay">1</span> |
  XP üî•: <span id="xpDisplay">0</span>
</div>

<button class="btn-main" onclick="handleClick()">TOCAR!</button>
<button class="btn-blue" onclick="openMenu('upgrades')">Upgrades</button>
<button class="btn-blue" onclick="openMenu('missions')">Miss√µes</button>
<button class="btn-blue" onclick="openMenu('ranking')">Ranking Global</button>

<div id="notif"></div>
<div id="menuArea"></div>

<script>

// ===========================
// ‚öôÔ∏è CONFIGURA√á√ÉO RANKING
// ===========================
const sheetID = "12qXDvr7ZooG9qk-6qN8ZO9eDGGFfITkiPKz36lMLgGA";
const gURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?`;

// ===========================
// üßæ DADOS DO JOGADOR
// ===========================
const player = {
  coins: 0,
  energy: 100,
  level: 1,
  xp: 0,
  upgrades: { power: 1, speed: 0 },
  missions: { clicks: 0, donePlay100: false, doneLevel5: false }
};

// ===========================
// üíæ LOCAL STORAGE
// ===========================
function saveAll(){ localStorage.setItem("impulse_evo_visual", JSON.stringify(player)); }
function loadAll(){
  const raw = localStorage.getItem("impulse_evo_visual");
  if(raw){ Object.assign(player, JSON.parse(raw)); }
}

// ===========================
// üïπÔ∏è GAMEPLAY
// ===========================
function handleClick(){
  if(player.energy <= 0){ notify("‚ö° Sem energia!"); return; }
  player.coins += player.upgrades.power;
  player.energy--;
  player.xp++;
  player.missions.clicks++;
  checkLevelUp();
  checkMissions();
  saveAll();
  updateDisplay();
}

// ===========================
// ‚≠ê NIVELAMENTO
// ===========================
function checkLevelUp(){
  if(player.xp >= player.level * 60){
    player.level++;
    player.energy = Math.min(player.energy + 20, 100);
    player.xp = 0;
    notify(`üéâ Subiu para N√≠vel ${player.level}!`);
  }
}

// ===========================
// üîî NOTIFICA√á√ïES
// ===========================
function notify(msg){
  const n = document.getElementById("notif");
  n.innerText = msg;
  setTimeout(()=> n.innerText = "", 2500);
}

// ===========================
// üìä DISPLAY
// ===========================
function updateDisplay(){
  document.getElementById("coinsDisplay").innerText = player.coins;
  document.getElementById("energyDisplay").innerText = player.energy;
  document.getElementById("levelDisplay").innerText = player.level;
  document.getElementById("xpDisplay").innerText = player.xp;
}

// ===========================
// üì± MENUS
// ===========================
function openMenu(type){
  let html = "";
  
  if(type == "upgrades"){
    html += `<div class="section"><h3>Upgrades</h3>`;
    html += btnList("Power +1 (50)", player.coins>=50, ()=>buy("power",50));
    html += btnList("Speed +20 energia (30)", player.coins>=30, ()=>buy("speed",30));
    html += `</div>`;
  }
  
  if(type == "missions"){
    html += `<div class="section"><h3>Miss√µes</h3>`;
    html += `<p class="${player.missions.donePlay100? 'mission-ok':'mission-no'}">‚Ä¢ Clique 100√ó</p>`;
    html += `<p class="${player.missions.doneLevel5? 'mission-ok':'mission-no'}">‚Ä¢ Chegar n√≠vel 5</p>`;
    html += `</div>`;
  }
  
  if(type == "ranking"){
    html += `<div class="section"><h3>Ranking Global por N√≠vel</h3><div id="rankList">Carregando...</div></div>`;
    fetchRank();
  }
  
  document.getElementById("menuArea").innerHTML = html;
}

// ===========================
// üí∞ UPGRADES
// ===========================
function btnList(text, ok, action){
  return `<button class="${ok ? 'btn-main' : 'btn-disabled'}" ${ok ? `onclick="${action.name}()"` : ""}>${text}</button><br>`;
}

function buy(type, cost){
  if(player.coins < cost){ notify("ü™ô Sem moedas suficientes!"); return; }
  player.coins -= cost;
  player.upgrades[type]++;
  saveAll();
  updateDisplay();
  openMenu("upgrades");
  notify("‚úÖ Upgraded!");
}

// ===========================
// üèÅ MISS√ïES
// ===========================
function checkMissions(){
  if(player.missions.clicks >= 100 && !player.missions.donePlay100){
    player.missions.donePlay100 = true;
    player.coins += 50;
    notify("üéØ Miss√£o conclu√≠da! +50 moedas");
  }
  if(player.level >= 5 && !player.missions.doneLevel5){
    player.missions.doneLevel5 = true;
    player.coins += 100;
    notify("üåü Miss√£o N√≠vel 5 conclu√≠da! +100 moedas");
  }
}

// ===========================
// üåç RANKING GLOBAL
// ===========================
async function fetchRank(){
  const query = encodeURIComponent("select A, C order by C desc limit 10");
  const url = `${gURL}tq=${query}`;
  try {
    const res = await fetch(url);
    const text = await res.text();
    const json = text.substring(text.indexOf("{"), text.lastIndexOf("}")+1);
    const data = JSON.parse(json).table.rows;
    
    let out = "<ol>";
    data.forEach(r => {
      const nm = r.c[0]? r.c[0].v : "‚Äî";
      const lvl = r.c[1]? r.c[1].v : 0;
      out += `<li>${nm} ‚Äî ‚≠ê ${lvl}</li>`;
    });
    out += "</ol>";
    
    document.getElementById("rankList").innerHTML = out;
  } catch(e){
    document.getElementById("rankList").innerHTML = "‚ö†Ô∏è N√£o foi poss√≠vel carregar ranking.";
  }
}

// ===========================
// ‚è±Ô∏è ENERGIA REGEN
// ===========================
setInterval(()=>{
  if(player.energy < 100){
    player.energy++;
    saveAll();
    updateDisplay();
  }
}, 5000);

// ===========================
// üü¢ IN√çCIO
// ===========================
loadAll();
Telegram.WebApp.expand();
updateDisplay();

</script>
</body>
</html>
