<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Impulse Evolution PRO üöÄ</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  body {
    background:#0a1f3f;
    color:#edf2f7;
    font-family:Arial,sans-serif;
    text-align:center;
    padding-top:20px;
  }
  h1 { font-size:28px; margin-bottom:6px; }
  .stats { font-size:18px; margin:10px; }
  button {
    margin:6px;
    padding:14px 30px;
    font-size:20px;
    border:none;
    border-radius:12px;
    cursor:pointer;
    transition:0.13s;
  }
  button:active { transform:scale(0.95); }
  .btn-main { background:#22c55e;color:white;box-shadow:0px 5px #166f33; }
  .btn-blue { background:#3b82f6;color:white;box-shadow:0px 5px #1e40af; }
  .btn-disabled { background:#6b7280;color:#cbd5e1;cursor:not-allowed; }
  #menuArea { margin-top:22px;font-size:18px; }
  .section { margin-top:18px;padding:12px;background:#1e3a66;border-radius:10px; }
  #notif { font-size:20px;margin-top:10px;color:#fde047; }
  #rankList li { text-align:left;font-size:18px;margin:3px 0; }
</style>
</head>
<body>

<h1>Impulse Evolution PRO üöÄ</h1>

<div class="stats">
  ü™ô <span id="coinsDisplay">0</span> |
  ‚ö° <span id="energyDisplay">0</span>/100 |
  ‚≠ê <span id="levelDisplay">1</span> |
  üî• <span id="xpDisplay">0</span>
</div>

<button class="btn-main" onclick="btnClick()">TOCAR!</button>
<button class="btn-blue" onclick="openMenu('upgrades')">Upgrades</button>
<button class="btn-blue" onclick="openMenu('missions')">Miss√µes</button>
<button class="btn-blue" onclick="openMenu('ranking')">Ranking</button>

<div id="notif"></div>
<div id="menuArea"></div>

<script>
// ----------------------------------------------------------------------
// üîß COLE AQUI O LINK DA SUA API DO GOOGLE APPS SCRIPT
// ----------------------------------------------------------------------
const backendURL = "https://script.google.com/macros/s/AKfycbxYj0ldxCreMr31GCFHbZmm9VTPRh-Lug3jdajGldnO80TtfYrmhHota2OstiQ2WLFE/exec";

// ----------------------------------------------------------------------
// üì¶ ESTADO DO JOGADOR
// ----------------------------------------------------------------------
const player = {
  name: "",
  coins: 0,
  energy: 100,
  level: 1,
  xp: 0,
  upgrades: { power: 1, speed: 0 },
  missions: { clicks: 0, done100: false, doneLvl5: false }
};

// ----------------------------------------------------------------------
// üíæ SALVAR EM LOCALSTORAGE
// ----------------------------------------------------------------------
function saveLocal() {
  localStorage.setItem("impulse_pro_data", JSON.stringify(player));
}
function loadLocal() {
  const raw = localStorage.getItem("impulse_pro_data");
  if (raw) Object.assign(player, JSON.parse(raw));
}

// ----------------------------------------------------------------------
// üìä ATUALIZA√á√ÉO DE TELA
// ----------------------------------------------------------------------
function updateDisplay() {
  document.getElementById("coinsDisplay").innerText = player.coins;
  document.getElementById("energyDisplay").innerText = player.energy;
  document.getElementById("levelDisplay").innerText = player.level;
  document.getElementById("xpDisplay").innerText = player.xp;
}

// ----------------------------------------------------------------------
// üïπÔ∏è JOGADA DO CLIQUE
// ----------------------------------------------------------------------
function btnClick() {
  if (player.energy <= 0) {
    alert("‚ö° Sem energia!");
    return;
  }
  player.coins += player.upgrades.power;
  player.energy--;
  player.xp++;
  player.missions.clicks++;
  checkLevelUp();
  checkMissions();
  saveLocal();
  updateDisplay();
}

// ----------------------------------------------------------------------
// ‚≠ê SUBIDA DE N√çVEL
// ----------------------------------------------------------------------
function checkLevelUp() {
  if (player.xp >= player.level * 60) {
    player.level++;
    player.xp = 0;
    player.energy = Math.min(player.energy + 20, 100);
    alert("‚≠ê Subiu de n√≠vel!");
  }
}

// ----------------------------------------------------------------------
// üéØ MISS√ïES
// ----------------------------------------------------------------------
function checkMissions() {
  if (player.missions.clicks >= 100 && !player.missions.done100) {
    player.missions.done100 = true;
    player.coins += 50;
    alert("üéØ Miss√£o 100 cliques conclu√≠da!");
  }
  if (player.level >= 5 && !player.missions.doneLvl5) {
    player.missions.doneLvl5 = true;
    player.coins += 100;
    alert("üåü Miss√£o N√≠vel 5 conclu√≠da!");
  }
}

// ----------------------------------------------------------------------
// üìã MENUS
// ----------------------------------------------------------------------
function openMenu(type) {
  let html = "";
  if (type == "upgrades") {
    html += "<div class='section'><h3>Upgrades</h3>";
    html += btnUI("Power +1 (50)", player.coins >= 50, () => buy("power", 50));
    html += btnUI("Speed +20 energia (30)", player.coins >= 30, () => buy("speed", 30));
    html += "</div>";
  }
  if (type == "missions") {
    html += "<div class='section'><h3>Miss√µes</h3>";
    html += `<p>${player.missions.done100 ? "‚úîÔ∏è" : "‚ùå"} Clique 100√ó</p>`;
    html += `<p>${player.missions.doneLvl5 ? "‚úîÔ∏è" : "‚ùå"} Chegar N√≠vel 5</p>`;
    html += "</div>";
  }
  if (type == "ranking") {
    html += "<div class='section'><h3>Ranking Global</h3>";
    html += "<button class='btn-blue' onclick='sendRank()'>Enviar meu score</button><br><br>";
    html += "<div id='rankList'>Carregando...</div></div>";
    fetchRank();
  }
  document.getElementById("menuArea").innerHTML = html;
}

function btnUI(txt, ok, act) {
  return `<button class='${ok ? "btn-main" : "btn-disabled"}' ${ok ? `onclick="${act.name}()"` : ""}>${txt}</button><br>`;
}

function buy(type, cost) {
  if (player.coins < cost) {
    alert("Moedas insuficientes!");
    return;
  }
  player.coins -= cost;
  player.upgrades[type]++;
  saveLocal();
  updateDisplay();
  openMenu("upgrades");
}

// ----------------------------------------------------------------------
// üåç RANKING GLOBAL (GET)
// ----------------------------------------------------------------------
async function fetchRank() {
  try {
    let res = await fetch(backendURL);
    let data = await res.json();
    let out = "<ol>";
    data.slice(0, 10).forEach(p => {
      out += `<li>${p.name} ‚Äî ‚≠ê ${p.score}</li>`;
    });
    out += "</ol>";
    document.getElementById("rankList").innerHTML = out;
  } catch {
    document.getElementById("rankList").innerHTML = "Erro ao carregar ranking";
  }
}

// ----------------------------------------------------------------------
// üì§ ENVIO DO RANKING (POST)
// ----------------------------------------------------------------------
async function sendRank() {
  let name = prompt("Digite seu apelido para o Ranking:");
  if (!name) return;
  player.name = name;
  saveLocal();
  let body = JSON.stringify({
    name: player.name,
    coins: player.coins,
    level: player.level,
    xp: player.xp
  });
  await fetch(backendURL, { method: "POST", body: body });
  alert("üì§ Seu score foi enviado!");
  fetchRank();
}

// ----------------------------------------------------------------------
// üîÅ REGEN DE ENERGIA
// ----------------------------------------------------------------------
setInterval(() => {
  if (player.energy < 100) {
    player.energy++;
    saveLocal();
    updateDisplay();
  }
}, 5000);

// ----------------------------------------------------------------------
// üü¢ INICIALIZA√á√ÉO
// ----------------------------------------------------------------------
loadLocal();
Telegram.WebApp.expand();
updateDisplay();
</script>

</body>
</html>

